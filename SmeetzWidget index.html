<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smeetz Widget ‚Äì Optimized</title>

  <!-- üî• Preload the widget JS for faster load -->
  <link rel="preload" href="https://test.tracker.smeetz.com/smeetz-main-widget.js" as="script">

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .test-container {
      background: white;
      padding: 40px;
      border-radius: 10px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      text-align: center;
      max-width: 800px;
      width: 100%;
    }
    h1 {
      color: #333;
      margin-bottom: 30px;
    }
    .widget-status {
      margin: 20px 0;
      padding: 12px;
      border-radius: 6px;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    .status-loading { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    .status-ready { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .status-iframe { background: #cfe2ff; color: #084298; border: 1px solid #b6d4fe; }

    .smeetz-book-button {
      background: #8BDBE7 !important;
      color: #fff !important;
      padding: 15px 30px !important;
      border-radius: 5px !important;
      font-size: 18px !important;
      font-weight: bold !important;
      cursor: pointer !important;
      text-decoration: none !important;
      display: inline-block !important;
      margin: 20px 0;
      border: none;
      transition: 0.3s;
    }
    .smeetz-book-button:hover {
      background: #7BC8D5 !important;
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(139,219,231,0.3);
    }

    /* Debug panel */
    .debug-panel {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #fff;
      padding: 18px;
      border-radius: 10px;
      border: 2px solid #007bff;
      max-width: 300px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      max-height: 80vh;
      overflow-y: auto;
    }
    .debug-panel h3 {
      margin: 0 0 10px;
      color: #007bff;
    }
    .debug-entry {
      background: #f8f9fa;
      border-left: 3px solid #007bff;
      padding: 8px;
      font-family: monospace;
      font-size: 12px;
      margin-bottom: 8px;
      word-break: break-word;
    }
    .debug-button {
      background: #28a745;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px 0;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <div class="test-container">
    <h1>üéüÔ∏è Smeetz Widget ‚Äì Optimized</h1>

    <!-- Widget Status -->
    <div id="widget-status" class="widget-status status-loading">
      Loading widget‚Ä¶
    </div>

    <!-- Trigger Button -->
    <a
      id="smeetz-widget-button"
      class="smeetz-book-button"
      onclick="event.preventDefault(); _smtz('openwidget');"
    >
      üìÖ Open Booking Widget
    </a>

    <!-- Widget mount point -->
    <div class="smtz-w" data-smtz-gid="16342" data-smtz-wid="313"></div>
  </div>

  <!-- Debug Panel -->
  <div class="debug-panel">
    <h3>üêõ Debug Console</h3>
    <button class="debug-button" onclick="debugWidget()">Check Widget</button>
    <button class="debug-button" onclick="debugIframe()">Check Iframe</button>
    <div id="debug-log"></div>
  </div>

  <!-- Widget Loader -->
  <script>
    // Load widget with defer for speed
    !function(e, t, n, i, p, r, s) {
      e[n] || (
        (p = e[n] = function() { p.p ? p.p.apply(p, arguments) : p.q.push(arguments); })
        .q = [],
        p.t = Date.now(),
        p.g = "16342",
        (r = t.createElement("script")).defer = true,
        r.src = "https://test.tracker.smeetz.com/smeetz-main-widget.js",
        (s = t.getElementsByTagName("script")[0]).parentNode.insertBefore(r, s)
      );
    }(window, document, "_smtz");
  </script>

  <!-- Main Logic -->
  <script>
    const statusBox = document.getElementById("widget-status");
    const debugLog = document.getElementById("debug-log");

    function log(msg, type = "info") {
      const entry = document.createElement("div");
      entry.className = "debug-entry";
      entry.style.borderLeftColor =
        type === "success" ? "#28a745" : type === "error" ? "#dc3545" : "#007bff";
      entry.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${msg}`;
      debugLog.prepend(entry);
    }

    /* FAST ‚Äî Event-based widget ready detection */
    function widgetReady() {
      statusBox.textContent = "‚úÖ Widget Ready";
      statusBox.className = "widget-status status-ready";
      log("Widget is ready", "success");

      observeIframe();
    }

    // Attach widget ready event
    _smtz("on", "widget:ready", widgetReady);

    // Fallback if event not emitted
    setTimeout(() => {
      if (window._smtz && window._smtz.p) widgetReady();
    }, 400);

    /* Fast iframe detection */
    function observeIframe() {
      const wrapper = document.querySelector(".smtz-w");
      const obs = new MutationObserver((muts) => {
        muts.forEach((m) => {
          m.addedNodes.forEach((node) => {
            if (node.tagName === "IFRAME") {
              statusBox.textContent = "üìã Iframe Loaded";
              statusBox.className = "widget-status status-iframe";
              log("Iframe detected", "success");
            }
          });
        });
      });

      obs.observe(wrapper, { childList: true, subtree: true });
    }

    /* Debug button functions */
    function debugWidget() {
      log("Widget object: " + JSON.stringify({
        smtzExists: typeof _smtz !== "undefined",
        loaded: !!(window._smtz && window._smtz.p)
      }, null, 2));
    }

    function debugIframe() {
      const iframe = document.querySelector("iframe.smtz-lightbox-iframe");
      if (!iframe) return log("Iframe NOT found", "error");

      log("Iframe FOUND: " + iframe.src, "success");
    }
  </script>
</body>
</html>
